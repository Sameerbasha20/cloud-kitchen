<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cart | CloudKitchen</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>

<!-- ===============================
     NAVBAR LOADER
================================ -->
<script type="module">
  import { initNavbar } from "./navbar.js";

  fetch("navbar.html")
    .then(res => res.text())
    .then(html => {
      document.body.insertAdjacentHTML("afterbegin", html);
      initNavbar("cart");
    });
</script>

<!-- ===============================
     CART
================================ -->
<section class="cart">
  <div class="container">

    <div class="section-header">
      <h2>Your Cart</h2>
      <p>Review items before placing order</p>
    </div>

    <div id="cart-items"></div>

    <div class="cart-summary">
      <h3 id="cart-total">Total: ₹0</h3>
      <button id="place-order" class="btn-primary">Place Order</button>
    </div>

  </div>
</section>

<!-- ===============================
     FOOTER
================================ -->
<footer class="footer">
  <p>© 2026 CloudKitchen</p>
</footer>

<!-- ===============================
     CART LOGIC
================================ -->
<script type="module">
  import { getCart, updateCartCount, placeOrder } from "./cart.js";

  const cartItemsEl = document.getElementById("cart-items");
  const totalEl = document.getElementById("cart-total");
  const placeOrderBtn = document.getElementById("place-order");

  let cart = getCart();

  function persistCart() {
    localStorage.setItem("cart", JSON.stringify(cart));
    updateCartCount();
  }

  function renderCart() {
    cartItemsEl.innerHTML = "";
    let total = 0;

    if (cart.length === 0) {
      cartItemsEl.innerHTML = "<p>Your cart is empty.</p>";
      totalEl.textContent = "Total: ₹0";
      placeOrderBtn.disabled = true;
      return;
    }

    placeOrderBtn.disabled = false;

    cart.forEach((item, index) => {
      total += item.price * item.qty;

      const div = document.createElement("div");
      div.className = "cart-item";

      div.innerHTML = `
        <img src="${item.imageUrl}" alt="${item.name}">
        <div class="cart-info">
          <h4>${item.name}</h4>
          <p>₹${item.price} × ${item.qty}</p>
          <div class="cart-actions">
            <button class="qty-btn inc">+</button>
            <button class="qty-btn dec">−</button>
            <button class="remove-btn">Remove</button>
          </div>
        </div>
      `;

      div.querySelector(".inc").onclick = () => {
        item.qty++;
        persistCart();
        renderCart();
      };

      div.querySelector(".dec").onclick = () => {
        item.qty--;
        if (item.qty <= 0) cart.splice(index, 1);
        persistCart();
        renderCart();
      };

      div.querySelector(".remove-btn").onclick = () => {
        cart.splice(index, 1);
        persistCart();
        renderCart();
      };

      cartItemsEl.appendChild(div);
    });

    totalEl.textContent = `Total: ₹${total}`;
  }

  placeOrderBtn.onclick = async () => {
    await placeOrder();
    cart = getCart();
    renderCart();
  };

  updateCartCount();
  renderCart();
</script>

<!-- EXISTING JS -->
<script type="module" src="auth.js"></script>
<script src="scroll.js"></script>

</body>
</html>
