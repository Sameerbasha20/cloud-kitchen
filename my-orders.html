<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Orders | CloudKitchen</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>

<!-- ===============================
     ORDERS SECTION
================================ -->
<section class="orders">
  <div class="container">

    <div class="section-header">
      <h2>My Orders</h2>
      <p>Your recent orders and their status</p>
    </div>

    <div id="orders-list"></div>

  </div>
</section>

<!-- ===============================
     FOOTER
================================ -->
<footer class="footer">
  <p>© 2026 CloudKitchen</p>
</footer>

<!-- ===============================
     NAVBAR LOADER
================================ -->
<script type="module">
  import { initNavbar } from "./navbar.js";

  fetch("navbar.html")
    .then(res => res.text())
    .then(html => {
      document.body.insertAdjacentHTML("afterbegin", html);
      initNavbar();
    });
</script>

<!-- ===============================
     ORDERS LOGIC
================================ -->
<script type="module">
  import { auth, db } from "./firebase.js";
  import {
    collection,
    query,
    where,
    orderBy,
    getDocs
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const ordersList = document.getElementById("orders-list");

  auth.onAuthStateChanged(async (user) => {
    if (!user) {
      ordersList.innerHTML = "<p>Please login to view your orders.</p>";
      return;
    }

    const q = query(
      collection(db, "orders"),
      where("userId", "==", user.uid),
      orderBy("createdAt", "desc")
    );

    const snapshot = await getDocs(q);

    if (snapshot.empty) {
      ordersList.innerHTML = "<p>No orders yet.</p>";
      return;
    }

    ordersList.innerHTML = "";

    snapshot.forEach(docSnap => {
      const order = docSnap.data();
      const date = order.createdAt?.toDate().toLocaleString() || "";

      let itemsHtml = "";
      order.items.forEach(item => {
        itemsHtml += `
          <li>
            ${item.name} × ${item.qty} — ₹${item.price * item.qty}
          </li>
        `;
      });

      const div = document.createElement("div");
      div.className = "order-card";

      div.innerHTML = `
        <h4>Order ID: ${docSnap.id}</h4>
        <p><strong>Date:</strong> ${date}</p>
        <p><strong>Status:</strong> ${order.status}</p>
        <ul>${itemsHtml}</ul>
        <h4>Total: ₹${order.total}</h4>
      `;

      ordersList.appendChild(div);
    });
  });
</script>

</body>
</html>
