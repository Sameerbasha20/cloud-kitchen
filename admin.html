<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard | CloudKitchen</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>

<!-- ===============================
     NAVBAR LOADER
================================ -->
<script type="module">
  import { initNavbar } from "./navbar.js";

  fetch("navbar.html")
    .then(res => res.text())
    .then(html => {
      document.body.insertAdjacentHTML("afterbegin", html);
      initNavbar("admin"); // ✅ admin page
    });
</script>

<!-- ===============================
     ADMIN ORDERS SECTION
================================ -->
<section class="orders">
  <div class="container">

    <div class="section-header">
      <h2>Kitchen Orders</h2>
      <p>Manage incoming orders</p>
    </div>

    <div id="orders-list"></div>

  </div>
</section>

<!-- ===============================
     FOOTER
================================ -->
<footer class="footer">
  <p>© 2026 CloudKitchen</p>
</footer>

<!-- ===============================
     ADMIN LOGIC
================================ -->
<script type="module">
  import { db } from "./firebase.js";
  import {
    collection,
    query,
    orderBy,
    getDocs,
    updateDoc,
    doc
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const ordersList = document.getElementById("orders-list");

  async function loadOrders() {
    ordersList.innerHTML = "<p>Loading orders...</p>";

    const q = query(
      collection(db, "orders"),
      orderBy("createdAt", "desc")
    );

    const snapshot = await getDocs(q);

    if (snapshot.empty) {
      ordersList.innerHTML = "<p>No orders yet.</p>";
      return;
    }

    ordersList.innerHTML = "";

    snapshot.forEach(docSnap => {
      const order = docSnap.data();
      const orderId = docSnap.id;
      const date = order.createdAt?.toDate().toLocaleString() || "";

      let itemsHtml = "";
      order.items.forEach(item => {
        itemsHtml += `<li>${item.name} × ${item.qty}</li>`;
      });

      const div = document.createElement("div");
      div.className = "order-card";

      div.innerHTML = `
        <h4>Order ID: ${orderId}</h4>
        <p><strong>User:</strong> ${order.userName || order.userId}</p>
        <p><strong>Date:</strong> ${date}</p>
        <ul>${itemsHtml}</ul>
        <p><strong>Total:</strong> ₹${order.total}</p>

        <label>Status:</label>
        <select class="status-select">
          <option value="pending">pending</option>
          <option value="preparing">preparing</option>
          <option value="delivered">delivered</option>
        </select>
      `;

      const select = div.querySelector(".status-select");
      select.value = order.status;

      select.onchange = async () => {
        await updateDoc(doc(db, "orders", orderId), {
          status: select.value
        });
        alert("Order status updated");
      };

      ordersList.appendChild(div);
    });
  }

  loadOrders();
</script>

</body>
</html>
